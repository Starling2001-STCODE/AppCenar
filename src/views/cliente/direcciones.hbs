<div class="d-flex justify-content-between align-items-center mb-3">
    <button class="btn btn-outline-primary d-inline-flex align-items-center" type="button" data-bs-toggle="offcanvas"
        data-bs-target="#{{sidebarOffcanvasId}}" aria-controls="{{sidebarOffcanvasId}}">
        <i class="bi bi-list me-2"></i>
        Menú
    </button>

    {{#if currentUser}}
    <div class="text-end">
        <div class="fw-semibold">
            {{currentUser.nombre}}
        </div>
        <div class="small text-muted">
            {{currentUser.email}}
        </div>
    </div>
    {{/if}}
</div>

<div class="offcanvas offcanvas-start" tabindex="-1" id="{{sidebarOffcanvasId}}"
    aria-labelledby="{{sidebarOffcanvasId}}Label">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="{{sidebarOffcanvasId}}Label">
            {{sidebar.title}}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        {{#if currentUser}}
        <div class="mb-3 pb-3 border-bottom d-flex align-items-center gap-2">
            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px;">
                <i class="bi bi-person"></i>
            </div>
            <div>
                <div class="fw-semibold">{{currentUser.nombre}}</div>
                <div class="small text-muted">{{currentUser.email}}</div>
            </div>
        </div>
        {{/if}}

        {{> sidebar sidebar}}
    </div>
</div>

<div class="mt-3">
    <div class="row g-4">
        <div class="col-12 col-lg-7">
            <h1 class="h5 mb-3">
                Mis direcciones
            </h1>

            {{#if hasAddresses}}
            <div class="list-group">
                {{#each direcciones}}
                <div class="list-group-item">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="fw-semibold">
                                {{#if this.alias}}
                                {{this.alias}}
                                {{else}}
                                Dirección
                                {{/if}}
                            </div>
                            <div class="small">
                                {{this.linea1}}
                            </div>
                            {{#if this.referencia}}
                            <div class="small text-muted">
                                {{this.referencia}}
                            </div>
                            {{/if}}
                        </div>
                        <div class="d-flex flex-column align-items-end gap-1">
                            <a href="/cliente/direcciones/{{this._id}}/editar" class="btn btn-sm btn-outline-primary">
                                Editar
                            </a>
                            <form method="POST" action="/cliente/direcciones/{{this._id}}/eliminar"
                                onsubmit="return confirm('¿Eliminar esta dirección?');">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    Eliminar
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
            {{else}}
            <p class="text-muted">
                Aún no tienes direcciones guardadas.
            </p>
            {{/if}}
        </div>

        <div class="col-12 col-lg-5">
            <div class="card">
                <div class="card-body">
                    <h2 class="h6 mb-3">
                        Nueva dirección
                    </h2>

                    {{#if formError}}
                    <div class="alert alert-danger">
                        {{formError}}
                    </div>
                    {{/if}}

                    <form method="POST" action="/cliente/direcciones">
                        <div class="mb-3">
                            <label for="alias" class="form-label">Alias (opcional)</label>
                            <input type="text" id="alias" name="alias"
                                class="form-control {{#if errors.alias}}is-invalid{{/if}}" value="{{old.alias}}"
                                placeholder="Casa, Trabajo, Apartamento 3B..." />
                            {{#if errors.alias}}
                            <div class="invalid-feedback">
                                {{errors.alias.msg}}
                            </div>
                            {{/if}}
                        </div>
                        <div class="mb-3">
                            <label for="linea1" class="form-label">Dirección</label>
                            <input type="text" id="linea1" name="linea1"
                                class="form-control {{#if errors.linea1}}is-invalid{{/if}}" value="{{old.linea1}}"
                                placeholder="Calle, número, edificio..." required />
                            {{#if errors.linea1}}
                            <div class="invalid-feedback">
                                {{errors.linea1.msg}}
                            </div>
                            {{/if}}
                        </div>
                        <div class="mb-3">
                            <label for="referencia" class="form-label">Referencia (opcional)</label>
                            <textarea id="referencia" name="referencia"
                                class="form-control {{#if errors.referencia}}is-invalid{{/if}}" rows="2"
                                placeholder="Punto de referencia, color de la casa, etc.">{{old.referencia}}</textarea>
                            {{#if errors.referencia}}
                            <div class="invalid-feedback">
                                {{errors.referencia.msg}}
                            </div>
                            {{/if}}
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            Guardar dirección
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>